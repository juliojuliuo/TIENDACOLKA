<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inversiones COLKA | Panel Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap');
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: white; }
        .glass { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .input-dark { background: #111; border: 1px solid #333; color: white; outline: none; transition: 0.3s; }
        .input-dark:focus { border-color: #3b82f6; }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen flex items-center justify-center text-zinc-500">
        Cargando Inversiones COLKA...
    </div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBcOlkenlK-ATzMg7LG12kukr7l1gPJZfY",
            authDomain: "inversiones-colka.firebaseapp.com",
            projectId: "inversiones-colka",
            storageBucket: "inversiones-colka.firebasestorage.app",
            messagingSenderId: "760185289386",
            appId: "1:760185289386:web:b7f0b49334b04efd40aed3"
        };
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.api = { collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc };
    </script>

    <script type="text/babel">
        const { ShoppingCart, Edit, Trash2, X, Phone, MapPin, Smartphone, ShieldCheck, Lock } = lucide;

        function App() {
            const [productos, setProductos] = React.useState([]);
            const [admin, setAdmin] = React.useState(false);
            const [showLogin, setShowLogin] = React.useState(false);
            const [pass, setPass] = React.useState("");
            const [editando, setEditando] = React.useState(null); // Producto siendo editado
            const [filtro, setFiltro] = React.useState("Todos");

            // Cargar productos
            React.useEffect(() => {
                const checkDb = setInterval(() => {
                    if (window.api) {
                        clearInterval(checkDb);
                        const { collection, onSnapshot } = window.api;
                        onSnapshot(collection(window.db, "productos"), (snap) => {
                            setProductos(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                        });
                    }
                }, 500);
            }, []);

            // Login
            const ingresar = () => {
                if(pass === "hola123") {
                    setAdmin(true);
                    setShowLogin(false);
                    setPass("");
                } else {
                    alert("Contraseña incorrecta");
                }
            };

            // Guardar (Nuevo o Editar)
            const guardar = async (e) => {
                e.preventDefault();
                const { nombre, precio, categoria, stock } = e.target.elements;
                const datos = {
                    nombre: nombre.value,
                    precio: precio.value,
                    categoria: categoria.value,
                    stock: stock.value
                };

                try {
                    const { collection, addDoc, doc, updateDoc } = window.api;
                    if(editando) {
                        await updateDoc(doc(window.db, "productos", editando.id), datos);
                        alert("Producto actualizado");
                    } else {
                        await addDoc(collection(window.db, "productos"), datos);
                        alert("Producto creado");
                    }
                    setEditando(null);
                    e.target.reset();
                } catch(err) {
                    alert("Error: " + err.message);
                }
            };

            const borrar = async (id) => {
                if(confirm("¿Eliminar producto?")) {
                    await window.api.deleteDoc(window.api.doc(window.db, "productos", id));
                }
            };

            const listaFiltrada = filtro === "Todos" ? productos : productos.filter(p => p.categoria === filtro);

            return (
                <div className="pb-20">
                    {/* NAVBAR */}
                    <nav className="fixed top-0 w-full z-40 bg-black/90 backdrop-blur border-b border-zinc-900 px-6 py-4 flex justify-between items-center">
                        <div>
                            <h1 className="text-xl font-black tracking-tighter italic">COLKA</h1>
                            <p className="text-[9px] text-blue-500 font-bold uppercase tracking-widest">Inversiones</p>
                        </div>
                        <button 
                            onClick={() => admin ? setAdmin(false) : setShowLogin(true)}
                            className={`px-4 py-2 rounded-lg text-[10px] font-bold uppercase ${admin ? 'bg-red-600' : 'bg-zinc-800'}`}
                        >
                            {admin ? "Cerrar Sesión" : "Admin Acceso"}
                        </button>
                    </nav>

                    {/* HERO BANNER */}
                    <header className="mt-20 px-6 py-20 text-center bg-gradient-to-b from-blue-900/20 to-black">
                        <span className="bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-[0.2em] mb-4 inline-block">Tienda Oficial</span>
                        <h2 className="text-5xl md:text-7xl font-black mb-6 tracking-tighter text-white">Tecnología <br/><span className="text-blue-600">Premium</span></h2>
                        <p className="text-zinc-500 max-w-md mx-auto mb-8">Celulares de alta gama, accesorios originales y la mejor garantía de Colcabamba.</p>
                        <div className="flex justify-center gap-4 text-xs font-bold uppercase text-zinc-400">
                            <span className="flex items-center gap-2"><ShieldCheck size={16}/> Garantía</span>
                            <span className="flex items-center gap-2"><MapPin size={16}/> Local Físico</span>
                        </div>
                    </header>

                    {/* PANEL DE GESTIÓN (SOLO ADMIN) */}
                    {admin && (
                        <div className="max-w-4xl mx-auto px-6 mb-20">
                            <div className="glass p-8 rounded-3xl border border-blue-900/50">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-bold flex items-center gap-2 text-blue-400"><Edit size={20}/> {editando ? "Editar Producto" : "Nuevo Ingreso"}</h3>
                                    {editando && <button onClick={() => setEditando(null)} className="text-xs text-red-500 underline">Cancelar edición</button>}
                                </div>
                                <form onSubmit={guardar} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input name="nombre" defaultValue={editando?.nombre} placeholder="Nombre (Ej: iPhone 15)" className="input-dark p-4 rounded-xl" required />
                                    <input name="precio" type="number" defaultValue={editando?.precio} placeholder="Precio (S/)" className="input-dark p-4 rounded-xl" required />
                                    <select name="categoria" defaultValue={editando?.categoria || "Celulares"} className="input-dark p-4 rounded-xl">
                                        <option value="Celulares">Celulares</option>
                                        <option value="Audífonos">Audífonos</option>
                                        <option value="Cargadores">Cargadores</option>
                                    </select>
                                    <input name="stock" type="number" defaultValue={editando?.stock} placeholder="Stock (Und)" className="input-dark p-4 rounded-xl" />
                                    <button className="col-span-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-bold uppercase text-xs transition-colors">
                                        {editando ? "Guardar Cambios" : "Publicar Producto"}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* FILTROS Y CATÁLOGO */}
                    <main className="max-w-6xl mx-auto px-6">
                        <div className="flex gap-2 overflow-x-auto pb-4 mb-8 no-scrollbar justify-center">
                            {["Todos", "Celulares", "Audífonos", "Cargadores"].map(c => (
                                <button key={c} onClick={() => setFiltro(c)} className={`px-6 py-2 rounded-full text-[10px] font-bold uppercase transition-all ${filtro === c ? 'bg-white text-black' : 'bg-zinc-900 text-zinc-500'}`}>
                                    {c}
                                </button>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {listaFiltrada.map(p => (
                                <div key={p.id} className="bg-zinc-900/50 border border-zinc-800 p-6 rounded-[2rem] hover:border-zinc-600 transition-all group">
                                    <div className="flex justify-between items-start mb-4">
                                        <span className="bg-zinc-800 text-[9px] font-bold px-3 py-1 rounded-full uppercase text-zinc-400">{p.categoria}</span>
                                        {admin && (
                                            <div className="flex gap-2">
                                                <button onClick={() => setEditando(p)} className="bg-blue-600/20 text-blue-500 p-2 rounded-lg hover:bg-blue-600 hover:text-white"><Edit size={14}/></button>
                                                <button onClick={() => borrar(p.id)} className="bg-red-600/20 text-red-500 p-2 rounded-lg hover:bg-red-600 hover:text-white"><Trash2 size={14}/></button>
                                            </div>
                                        )}
                                    </div>
                                    <div className="h-40 flex items-center justify-center bg-black/40 rounded-2xl mb-6">
                                        <Smartphone size={48} className="text-zinc-700 group-hover:text-blue-500 transition-colors"/>
                                    </div>
                                    <h3 className="text-xl font-bold mb-1">{p.nombre}</h3>
                                    <p className="text-xs text-zinc-500 mb-6">Stock disponible: {p.stock || 0}</p>
                                    <div className="flex items-center justify-between border-t border-zinc-800 pt-4">
                                        <span className="text-2xl font-black text-white">S/ {p.precio}</span>
                                        <button 
                                            onClick={() => window.open(`https://wa.me/51983200830?text=Hola, quiero comprar el ${p.nombre}`)}
                                            className="bg-white text-black p-3 rounded-xl hover:scale-105 transition-transform"
                                        >
                                            <ShoppingCart size={20}/>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    {/* MODAL LOGIN */}
                    {showLogin && (
                        <div className="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-6">
                            <div className="bg-zinc-900 p-8 rounded-3xl w-full max-w-sm border border-zinc-800">
                                <div className="flex justify-between items-center mb-8">
                                    <h3 className="font-bold text-xl flex items-center gap-2"><Lock size={20}/> Seguridad</h3>
                                    <button onClick={() => setShowLogin(false)}><X size={20}/></button>
                                </div>
                                <input 
                                    type="password" 
                                    placeholder="Contraseña del sistema" 
                                    className="w-full input-dark p-4 rounded-xl mb-4 text-center tracking-widest"
                                    value={pass}
                                    onChange={(e) => setPass(e.target.value)}
                                />
                                <button onClick={ingresar} className="w-full bg-blue-600 py-4 rounded-xl font-bold uppercase text-xs">Acceder</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
