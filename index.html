<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inversiones COLKA | Tech Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#050505',
                        card: '#121212',
                        primary: '#3b82f6', // Azul Tech
                        accent: '#06b6d4'  // Cian Neon
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react?deps=react@18.2.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #050505; color: white; }
        /* Barra de desplazamiento bonita */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .neon-text { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot } from 'firebase/firestore';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { ShoppingCart, Search, Plus, Trash2, Edit2, X, LayoutDashboard, Store, Package, Tag, MapPin, Phone, Smartphone, Image as ImageIcon, Zap, ShieldCheck } from 'lucide-react';

        // --- TUS CREDENCIALES (NO TOCAR) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBcOLkenlK-ATzMgZL0i2kukr2l1gPJZfY",
            authDomain: "inversiones-colka.firebaseapp.com",
            projectId: "inversiones-colka",
            storageBucket: "inversiones-colka.firebasestorage.app",
            messagingSenderId: "760185289386",
            appId: "1:760185289386:web:b7f0b49334b04efd40aed3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = 'inversiones-colka-v1';

        const productsCol = collection(db, 'artifacts', appId, 'public', 'data', 'products');
        const categoriesCol = collection(db, 'artifacts', appId, 'public', 'data', 'categories');

        function App() {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [cart, setCart] = useState([]);
            const [search, setSearch] = useState('');
            const [activeCategory, setActiveCategory] = useState('Todos');
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [loading, setLoading] = useState(true);

            // Formulario
            const [showProductModal, setShowProductModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [newProduct, setNewProduct] = useState({ name: '', price: '', category: '', description: '', image: '', stock: 'Disponible' });
            const [newCatName, setNewCatName] = useState('');

            useEffect(() => {
                signInAnonymously(auth).catch(err => console.error(err));
                onAuthStateChanged(auth, setUser);
            }, []);

            useEffect(() => {
                const unsubProducts = onSnapshot(productsCol, (snap) => {
                    setProducts(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setLoading(false);
                });
                const unsubCats = onSnapshot(categoriesCol, (snap) => {
                    setCategories(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                return () => { unsubProducts(); unsubCats(); };
            }, []);

            const filteredProducts = useMemo(() => {
                return products.filter(p => {
                    const matchSearch = p.name?.toLowerCase().includes(search.toLowerCase());
                    const matchCat = activeCategory === 'Todos' || p.category === activeCategory;
                    return matchSearch && matchCat;
                });
            }, [products, search, activeCategory]);

            const addToCart = (product) => {
                setCart(prev => {
                    const exists = prev.find(item => item.id === product.id);
                    if (exists) return prev.map(item => item.id === product.id ? { ...item, qty: item.qty + 1 } : item);
                    return [...prev, { ...product, qty: 1 }];
                });
                setIsCartOpen(true);
            };

            const removeFromCart = (id) => setCart(prev => prev.filter(item => item.id !== id));
            const cartTotal = cart.reduce((acc, item) => acc + (parseFloat(item.price || 0) * item.qty), 0);

            const finalizarPedido = () => {
                const itemsText = cart.map(item => `- ${item.qty}x ${item.name} (S/ ${item.price})`).join('\n');
                const totalText = `\n*TOTAL: S/ ${cartTotal.toFixed(2)}*`;
                const fullMessage = `Hola Inversiones COLKA, deseo este pedido:\n\n${itemsText}${totalText}\n\nEspero confirmación.`;
                window.open(`https://wa.me/51910457625?text=${encodeURIComponent(fullMessage)}`, '_blank');
            };

            const saveProduct = async (e) => {
                e.preventDefault();
                try {
                    if (editingProduct) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', editingProduct.id), newProduct);
                    else await addDoc(productsCol, newProduct);
                    setShowProductModal(false); setEditingProduct(null);
                    setNewProduct({ name: '', price: '', category: '', description: '', image: '', stock: 'Disponible' });
                } catch (err) { alert("Error al guardar."); }
            };

            const addCategory = async () => { if(newCatName) { await addDoc(categoriesCol, { name: newCatName }); setNewCatName(''); }};
            const deleteItem = async (col, id) => { if(confirm("¿Eliminar?")) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', col, id)); };

            if (loading) return <div className="h-screen flex items-center justify-center bg-dark text-white"><div className="animate-spin w-10 h-10 border-4 border-primary border-t-transparent rounded-full"></div></div>;

            return (
                <div className="min-h-screen pb-20 selection:bg-primary selection:text-white">
                    {/* NAVBAR TECH */}
                    <nav className="fixed w-full z-50 top-0 border-b border-white/10 bg-dark/80 backdrop-blur-md">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="w-8 h-8 bg-gradient-to-tr from-primary to-accent rounded-lg flex items-center justify-center">
                                    <Zap size={18} className="text-white" fill="white" />
                                </div>
                                <div className="leading-none">
                                    <h1 className="text-xl font-bold tracking-tighter text-white">COLKA</h1>
                                    <span className="text-[10px] text-gray-400 tracking-widest uppercase">Inversiones</span>
                                </div>
                            </div>

                            <div className="flex items-center gap-4">
                                <button onClick={() => setIsAdmin(!isAdmin)} className={`px-4 py-2 rounded-full text-xs font-bold transition-all border ${isAdmin ? 'bg-primary border-primary text-white' : 'border-white/20 text-gray-300 hover:bg-white/10'}`}>
                                    {isAdmin ? 'VISTA TIENDA' : 'PANEL ADMIN'}
                                </button>
                                {!isAdmin && (
                                    <button onClick={() => setIsCartOpen(true)} className="relative p-2 text-white hover:text-accent transition-colors">
                                        <ShoppingCart size={24} />
                                        {cart.length > 0 && <span className="absolute top-0 right-0 bg-accent text-dark text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold shadow-lg shadow-accent/50">{cart.length}</span>}
                                    </button>
                                )}
                            </div>
                        </div>
                    </nav>

                    {isAdmin ? (
                        /* --- PANEL ADMIN (Oscuro) --- */
                        <div className="pt
